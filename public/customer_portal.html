<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TTS Customer Inquiry</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-sm">
  <div class="max-w-3xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow p-6">
      <h1 class="text-2xl font-bold text-gray-800">Rate Inquiry</h1>
      <p class="text-gray-600 mt-2">Submit your request and our team will get back to you soon.</p>

      <div id="resultBox" class="hidden mt-4 p-4 rounded-lg border"></div>

      <form id="rfqForm" class="mt-6 grid grid-cols-2 gap-3">
        <!-- Region -->
        <div class="col-span-2">
          <label class="block text-gray-700 font-semibold mb-1">Region *</label>
          <select name="region" class="border p-2 w-full rounded" required>
            <option value="">Select Region</option>
            <option>China Mainland</option>
            <option>Taiwan</option>
            <option>USA</option>
            <option>Others</option>
          </select>
        </div>

        <!-- Company / Contact -->
        <div class="col-span-2">
          <label class="block text-gray-700 font-semibold mb-1">Company Name *</label>
          <input name="companyName" class="border p-2 w-full rounded" required />
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-1">Contact Name *</label>
          <input name="contactName" class="border p-2 w-full rounded" required />
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">Phone</label>
          <input name="phone" class="border p-2 w-full rounded" />
        </div>

        <div class="col-span-2">
          <label class="block text-gray-700 font-semibold mb-1">Email *</label>
          <input name="email" type="email" class="border p-2 w-full rounded" required />
        </div>

        <!-- Inquiry basics -->
        <div class="col-span-2">
          <label class="block text-gray-700 font-semibold mb-1">Inquiry Type *</label>
          <select name="inquiryType" class="border p-2 w-full rounded" required>
            <option value="">Select Type</option>
            <option>Drayage</option>
            <option>Dry Van</option>
            <option>Flat Bed</option>
            <option>Drayage + Warehouse</option>
            <option>Warehouse Only</option>
          </select>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-1">Container Size</label>
          <select name="containerSize" class="border p-2 w-full rounded">
            <option value="">Container Size</option>
            <option>20'</option>
            <option>40'</option>
            <option>40HQ</option>
            <option>53'</option>
          </select>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-1">Dry Van Type</label>
          <select name="dryVanType" class="border p-2 w-full rounded">
            <option value="">Dry Van Type</option>
            <option>HOTSHOT</option>
            <option>28'</option>
            <option>53'</option>
            <option>LTL</option>
            <option>SMALL PARCEL</option>
          </select>
        </div>

        <div class="col-span-2">
          <label class="block text-gray-700 font-semibold mb-1">From *</label>
          <input name="from" class="border p-2 w-full rounded" placeholder="Port / Rail / Address" required />
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-1">To City *</label>
          <input name="toCity" class="border p-2 w-full rounded" required />
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">To State *</label>
          <input name="toState" class="border p-2 w-full rounded" required />
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-1">To ZIP *</label>
          <input name="toZip" class="border p-2 w-full rounded" required />
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">QTY</label>
          <input name="qty" class="border p-2 w-full rounded" />
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-1">Gross Weight</label>
          <input name="grossWeight" class="border p-2 w-full rounded" />
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-1">Live / Drop</label>
          <select name="liveOrDrop" class="border p-2 w-full rounded">
            <option value="">Select</option>
            <option>Live</option>
            <option>Drop</option>
          </select>
        </div>

        <div class="col-span-2 flex items-center gap-6 py-2">
          <label class="flex items-center gap-2"><input type="checkbox" name="hazmat" value="true" /> Hazmat</label>
          <label class="flex items-center gap-2"><input type="checkbox" name="reefer" value="true" /> Reefer</label>
          <label class="flex items-center gap-2"><input type="checkbox" name="bonded" value="true" /> Bonded</label>
        </div>

        <!-- Warehouse -->
        <div class="col-span-2 border-t pt-4 mt-2">
          <label class="flex items-center gap-2 font-semibold text-gray-700">
            <input type="checkbox" id="needWH" />
            Need Warehouse Service
          </label>

          <div id="whBlock" class="hidden mt-3">
            <label class="block text-gray-700 font-semibold mb-1">Warehouse Services</label>
            <div class="grid grid-cols-2 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Order Processing">Order Processing</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Inbound">Inbound</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Outbound">Outbound</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Sorting">Sorting</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Palletizing">Palletizing</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Pallet Fee">Pallet Fee</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Storage">Storage</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Label">Label</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="whService" value="Cross Dock">Cross Dock</label>
            </div>

            <div class="grid grid-cols-3 gap-3 mt-3">
              <input class="border p-2 rounded" name="estimatedPallets" placeholder="Estimated Pallets" />
              <input class="border p-2 rounded" name="estimatedBoxes" placeholder="Estimated Boxes / Cartons" />
              <input class="border p-2 rounded" name="estimatedSkuCount" placeholder="Estimated SKU Count" />
            </div>

            <div class="grid grid-cols-2 gap-3 mt-3">
              <input class="border p-2 rounded" name="storageDuration" placeholder="Storage Duration (number)" />
              <input class="border p-2 rounded" name="storageDurationUnit" placeholder="Duration Unit (Days/Weeks/Months)" />
            </div>

            <textarea class="border p-2 rounded w-full mt-3" name="warehouseNote" placeholder="Warehouse Note"></textarea>
          </div>
        </div>

        <div class="col-span-2">
          <label class="block text-gray-700 font-semibold mb-1">Note</label>
          <textarea name="note" class="border p-2 w-full rounded" rows="4" placeholder="Additional details..."></textarea>
        </div>

        <div class="col-span-2 mt-2">
          <button type="submit" class="w-full py-3 text-base font-semibold text-white rounded-full
                 bg-gradient-to-r from-blue-500 to-blue-600
                 shadow-md transition-all duration-200
                 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg">
            Submit Inquiry
          </button>
        </div>
      </form>
    </div>

    <p class="text-xs text-gray-500 mt-4 text-center">© Total Solution (TTS)</p>
  </div>

  <script>
    const needWH = document.getElementById('needWH');
    const whBlock = document.getElementById('whBlock');
    needWH.addEventListener('change', () => {
      whBlock.classList.toggle('hidden', !needWH.checked);
    });

    function setResult(type, html){
      const box = document.getElementById('resultBox');
      box.classList.remove('hidden');
      box.className = 'mt-4 p-4 rounded-lg border ' + (type === 'ok' ? 'border-green-300 bg-green-50 text-green-800' : 'border-red-300 bg-red-50 text-red-800');
      box.innerHTML = html;
    }

    document.getElementById('rfqForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const fd = new FormData(form);
      const data = Object.fromEntries(fd.entries());

      // checkboxes
      data.hazmat = form.querySelector('input[name="hazmat"]')?.checked ? 'true' : 'false';
      data.reefer = form.querySelector('input[name="reefer"]')?.checked ? 'true' : 'false';
      data.bonded = form.querySelector('input[name="bonded"]')?.checked ? 'true' : 'false';
      data.needWarehouseService = needWH.checked ? 'true' : 'false';

      const selectedServices = Array.from(form.querySelectorAll('input[name="whService"]:checked')).map(x => x.value);
      data.warehouseServices = selectedServices.join('; ');
      data.warehouseServiceDetail = selectedServices.map(s => `✅ ${s}`).join(' | ');

      // To composite
      const toCity = (data.toCity || '').trim();
      const toState = (data.toState || '').trim();
      const toZip = (data.toZip || '').trim();
      data.to = [toCity, [toState, toZip].filter(Boolean).join(' ')].filter(Boolean).join(', ');

      try{
        const res = await fetch('/public/inquiries', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        const j = await res.json();
        if(!res.ok || !j.success){
          setResult('bad', '❌ Submit failed: ' + (j.message || res.status));
          return;
        }
        setResult('ok', `<div class="font-semibold">✅ Request received!</div>
          <div class="mt-1">Reference ID: <span class="font-mono">${j.portalRef}</span></div>
          <div class="mt-1">Assigned Sales: <span class="font-semibold">${j.assignedSales}</span></div>`);
        form.reset();
        needWH.checked = false;
        whBlock.classList.add('hidden');
        window.scrollTo({top:0, behavior:'smooth'});
      }catch(err){
        setResult('bad', '❌ Network error: ' + err.message);
      }
    });
  </script>
</body>
</html>
